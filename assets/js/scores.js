// link to see json urls of all sheet
// https://spreadsheets.google.com/feeds/worksheets/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/private/full

// list of all classes for an event
// [Advanced, Intermediate, Beginner]
// if order is different, it will be mentioned
// note that the order they appear on the site depends on the load time fo the json file, so order may vary

////// 42 Fist /////////
// A - I 
var _42FistMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ou6mt73/public/values?alt=json","https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ok3wn6n/public/values?alt=json"];
// A
var _42FistFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/odqqwz1/public/values?alt=json"];

////// 42 Sword /////////
// A - I
var _42SwordMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oxalikq/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ok4j979/public/values?alt=json"];
// A 
var _42SwordFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oaxpmti/public/values?alt=json"];

////// broadsword /////////
var broadswordMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ol2jmy5/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ot8kbdh/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o7t38eh/public/values?alt=json"];
var broadswordFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/orjuvwq/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ou3jh5z/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oe7m1uw/public/values?alt=json"];

////// Chang Quan /////////
var changQuanMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o56zo39/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oqnee8r/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o52uj0h/public/values?alt=json"];
var changQuanFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/odmwbu6/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/om0izj8/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o50yv1d/public/values?alt=json"];

////// Internal Open Fist /////////
// A 
var internalOpenFistMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ot8t0jb/public/values?alt=json"];
var internalOpenFistFemale = [];

////// Nandao /////////
// A - I
var nandaoMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ome90gl/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/otizfqy/public/values?alt=json"];
var nandaoFemale = [];

////// Nan Quan /////////
var nanQuanMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o5tfsxf/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ogofp92/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oftz7jz/public/values?alt=json"];
var nanQuanFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/odmm4hb/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/owch7la/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/onggqec/public/values?alt=json"];

////// Open Barehand /////////
// A - I
var openBarehandMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/osfo1cv/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o4j4tk5/public/values?alt=json"];
// 
var openBarehandFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oidjv1b/public/values?alt=json"];

////// Open Chen /////////
// A 
var openChenMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/om52n7s/public/values?alt=json"];
var openChenFemale = [];

////// Open Yang /////////
var openYangMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oly0fqk/public/values?alt=json"];
var openYangFemale = [];

////// Other Weapon /////////
// A - I
var otherWeaponMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o30i1vg/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o94wwfb/public/values?alt=json"];
// A - I
var otherWeaponFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o8nwjkt/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/od9wd1k/public/values?alt=json"];

////// Southern Staff /////////
// A - I
var southernStaffMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/owj790r/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o6dhh9q/public/values?alt=json"];
var southernStaffFemale = [];

////// Spear /////////
// A - I
var spearMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ofel1k1/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o15qp2s/public/values?alt=json"];
// A - I
var spearFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o4guxmy/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ouyf7wk/public/values?alt=json"];

////// Staff /////////
var staffMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oqpajtw/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ogucqpy/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oj1z8yl/public/values?alt=json"];
//B
var staffFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ofprtkz/public/values?alt=json"];

////// Straight Sword /////////
var straightSwordMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/om8jjda/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/om9e4t8/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ojrfy6l/public/values?alt=json"];
var straightSwordFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o79ceuj/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/os96269/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o4fvp8k/public/values?alt=json"];

////// 24 Taiji /////////
//A - I
var _24TaijiMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o9zzzsy/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oemgiqj/public/values?alt=json"];
// A - I
var _24TaijiFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o9plhcs/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o867loh/public/values?alt=json"];

////// Taiji Weapon /////////
// A - I
var taijiWeaponMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oqevoq2/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/odk53li/public/values?alt=json"];
// A
var taijiWeaponFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/of03a5/public/values?alt=json"];

////// Traditional Long Weapon /////////
// A
var traLongWeaponMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o46vn8m/public/values?alt=json"];
// I 
var traLongWeaponFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o4ksuqj/public/values?alt=json"];

////// Traditional Open Barehand /////////
var traOpenBarehandMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o439kjy/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ox22a3z/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o5bixha/public/values?alt=json"];
// A - B
var traOpenBarehandFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/of5c0lg/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/odzaaoc/public/values?alt=json"];

////// Traditional Short Weapon /////////
// A - I 
var traShortWeaponMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o6mdg5d/public/values?alt=json", "https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/oy3akmv/public/values?alt=json"];
// I 
var traShortWeaponFemale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/ooolek0/public/values?alt=json"];

////// Traditional Soft Weapon /////////
// A
var traSoftWeaponMale = ["https://spreadsheets.google.com/feeds/list/1qtzqblx66JOztuDTtHLGnpx7jOAeefii29MsRL6GByI/o327kce/public/values?alt=json"];
var traSoftWeaponFemale = [];

// Array containing an array of the events
var jsonListMale = [
	_42FistMale, _42SwordMale, broadswordMale, changQuanMale, internalOpenFistMale, nandaoMale, nanQuanMale, openBarehandMale, openChenMale, openYangMale, otherWeaponMale, southernStaffMale, spearMale, staffMale, straightSwordMale, _24TaijiMale, taijiWeaponMale, traLongWeaponMale, traOpenBarehandMale, traShortWeaponMale, traSoftWeaponMale 
	];

var jsonListFemale = [
	_42FistFemale, _42SwordFemale, broadswordFemale, changQuanFemale, internalOpenFistFemale, nandaoFemale, nanQuanFemale, openBarehandFemale, openChenFemale, openYangFemale, otherWeaponFemale, southernStaffFemale, spearFemale, staffFemale, straightSwordFemale, _24TaijiFemale, taijiWeaponFemale, traLongWeaponFemale, traOpenBarehandFemale, traShortWeaponFemale, traSoftWeaponFemale 
	];

//variable showing which set of scores are currently shown
var currentScores = 0;

$(document).ready(function(){

	hideScores();

	//42 fist
	$("#event1-button").click(function(){
		toggleButton("1");
	});	

	// 42 sword
	$("#event2-button").click(function(){
		toggleButton("2");
	});	

	// broadsword
	$("#event3-button").click(function(){
		toggleButton("3");
	});	

	// chang quan
	$("#event4-button").click(function(){
		toggleButton("4");
	});	

	// internal open fist
	$("#event5-button").click(function(){
		toggleButton("5");
	});	

	// nandao
	$("#event6-button").click(function(){
		toggleButton("6");
	});	

	// nan quan
	$("#event7-button").click(function(){
		toggleButton("7");
	});	

	// Open Barehand
	$("#event8-button").click(function(){
		toggleButton("8");
	});	

	// Open Chen
	$("#event9-button").click(function(){
		toggleButton("9");
	});	

	// Open Yang
	$("#event10-button").click(function(){
		toggleButton("10");
	});	

	// Other Weapon
	$("#event11-button").click(function(){
		toggleButton("11");
	});	

	//Southern Staff
	$("#event12-button").click(function(){
		toggleButton("12");
	});	

	// Spear
	$("#event13-button").click(function(){
		toggleButton("13");
	});	

	// Staff
	$("#event14-button").click(function(){
		toggleButton("14");
	});	

	//Straight Sword
	$("#event15-button").click(function(){
		toggleButton("15");
	});	

	// 24 Taiji
	$("#event16-button").click(function(){
		toggleButton("16");
	});	

	// Taiji Weapon
	$("#event17-button").click(function(){
		toggleButton("17");
	});	

	// Traditional Long Weapon
	$("#event18-button").click(function(){
		toggleButton("18");
	});	

	//Traditional Open Barehand
	$("#event19-button").click(function(){
		toggleButton("19");
	});	

	// Traditional Short Weapon
	$("#event20-button").click(function(){
		toggleButton("20");
	});	

	// Traditional Soft Weapon
	$("#event21-button").click(function(){
		toggleButton("21");
	});	

});

var toggleButton = function (buttonNum) {

		hideScores();

		var buttonMapping = [ "42 Fist", "42 Sword", "Broadsword", "Chang Quan", "Internal Open Fist", "Nandao", "Nan Quan",
			"Open Barehand", "Open Chen", "Open Yang", "Other Weapon", "Southern Staff", "Spear", "Staff", "Straight Sword", "24 Taiji", "Taiji Weapon", "Traditional Long Weapon", "Traditional Open Barehand", "Traditional Short Weapon", "Traditional Soft Weapon"];

		if(currentScores != buttonNum){
			$("#scores-border-top").children().remove();
			$("#select-score").hide();
			currentScores = buttonNum;

			$("#scores-border-top").append("<h1>" + buttonMapping[buttonNum-1] + "</h1>");
			appendScores("male", buttonNum);				
			appendScores("female", buttonNum);

	        $("body").append('<div id="scores-border-bottom"></div>');
		}
		else{
			currentScores = 0;
			$("#select-score").show();
			$("#scores-border-top").children().remove();
		}
};

var parseJSON = function (numContestants, data) {
	var tempScore = [];
	for (i = 3; i < numContestants; i++){
		var tempContestant = [];

		//for each of the entries, take the entrants names and scores
		var content = data.feed.entry[i].content.$t;
		content = content.replace(/,/g, "");
		content = content.split(" ");

		// for every index of the json object make a new male contestant
		var currentIndex = 0;
		for(j = 0; j < content.length; j++) {
			//if there is no semi colon in the index, it's good
			if(content[j].indexOf(":") === -1){
				if(tempContestant[currentIndex-1] == undefined){
					tempContestant[currentIndex-1] = "";
				}
				tempContestant[currentIndex-1] = tempContestant[currentIndex-1] + " " + content[j];
			}
			else {
				currentIndex++;
			}
		}
		if(tempContestant.length > 0){
			tempScore[i-3] = tempContestant;
		}
	}

	return tempScore;
}

// chooses the right json feed and appends them depending on level and gender
var appendScores = function (gender, buttonNum) {

	var contestants = [];
	var numContestants = 0;
	var jsonList = [];
	var mainClass = "";
	var genderCol = "";

	// retrieve the json from the list of urls based on the button number

	if(gender === "male"){
		// male header
		$(".male").append("<h1>Male Scores</h1> <hr>");
		jsonList = jsonListMale;
		mainClass = ".male";
		genderCol = "male-col-"

	} else {
		$(".female").append("<h1>Female Scores</h1> <hr>");
		jsonList = jsonListFemale;
		mainClass = ".female";
		genderCol = "female-col-"
	}

	// competitor info
	// for all the json feeds of that event, add their scores to the list
	for(n = 0; n < jsonList[buttonNum - 1].length; n++){ 
		$.getJSON(jsonList[buttonNum - 1][n], function(data) {

			// get the level of the event
			var level = data.feed.entry[0].content.$t.split(" ");
			level = level[1];
			level = level.replace(/,/g, '');

			$(mainClass).append("<div class='col-sm-3 col-xs-3'></div><div class='level col-sm-9 col-xs-9'>" + level + "</div>")

			numContestants = data.feed.entry.length;
			contestants = parseJSON(numContestants, data);

			// append the entries to the scores page
			$(mainClass).append("<div class='col-sm-3 col-xs-3'></div><div class='" + genderCol + level + " col-sm-9 col-xs-9'></div>")
			for (i = 0; i < contestants.length; i++){
				var scoreString = "<div><b>" + contestants[i][0] + "</b>:";

				// adds the scores onto the string that will be appended
				for (j = 1; j < contestants[i].length; j++){
					// don't include the time
					if (j != 1){
						if (j+1 < contestants[i].length){
							scoreString = scoreString + " " + contestants[i][j] + " - ";
						}
						// if you are at the last number, it is the average
						else{
							scoreString = scoreString + " <b> avg: " + contestants[i][j] + "</b>";
						}
					}
					else {
						scoreString = scoreString + " time: " + contestants[i][j] + " - Scores: ";
					}
				}
				
				scoreString = scoreString + "</div>";
				var levelClass = mainClass + " ." + genderCol + level;
				$(levelClass).append(scoreString);
			}
			$(levelClass).append("<br>");
        });
	}
}

var hideScores = function () {
	$("#eventScores .male").children().remove();
	$("#eventScores .female").children().remove();
	$("#scores-border-bottom").remove();
	$("#select-score").show();
};